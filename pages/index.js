import Head from "next/head";
import { Inter } from "@next/font/google";
import Header from "@/components/Header";
import Footer from "@/components/Footer";
import { useEffect, useState } from "react";

const inter = Inter({ subsets: ["latin"] });

export default function Home() {
  const [randomJoke, setRandomJoke] = useState(null);
  const [reload, setReload] = useState(false);
  const [viewCount, SetViewCount] = useState(0);

  // fetch random joke on page load or when reload state changes
  useEffect(() => {
    async function fetchData() {
      try {
        const response = await fetch(
          "https://api.chucknorris.io/jokes/random?category=dev"
        );
        if (response.ok) {
          const data = await response.json();
          setRandomJoke(data);
        } else {
          throw new Error(`Something went wrong...`);
        }
      } catch (error) {
        alert(error.message);
      }
    }
    fetchData();
  }, [reload]);

  // fetch viewcount from api
  useEffect(() => {
    async function increaseViewCount() {
      const response = await fetch("/api/viewcount", { method: "POST" });
      if (response.ok) {
        const object = await response.json();
        SetViewCount(object.count);
      }
    }
    increaseViewCount();
  }, []);

  return (
    <>
      <Head>
        <title>Chuck Norris App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico?v=2" />
      </Head>
      <Header />

      <main className="flex flex-col max-w-5xl m-auto items-center">
        <section className="bg-gray-200 w-4/5 flex m-4 justify-between items-center shadow-2xl rounded-lg">
          <img className="m-4 w-1/2" src="/img/chuck.png" />
          <p className="m-4 font-bold text-xl italic font-sans text-gray-800">
            {`"${randomJoke?.value}"`}
          </p>
        </section>

        <button
          className="bg-gray-200 hover:bg-sky-700 shadow-2xl text-gray-800 font-bold py-2 px-4 rounded m-auto my-4"
          onClick={() => setReload(!reload)}
        >
          New One!
        </button>
      </main>
      <Footer viewCount={viewCount} />
    </>
  );
}
